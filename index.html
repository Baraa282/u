<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Reader</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-blue: #2A5C8A;
            --secondary-blue: #88BDEB;
            --dark-blue: #1A2E40;
            --light-blue: #E6F1F8;
            --white: #FFFFFF;
            --text-dark: #2A403D;
            --favorite-red: #FF4444; /* لون أحمر للمفضلة */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Amiri', serif;
            background-color: var(--white);
            line-height: 1.8;
            color: var(--text-dark);
            direction: ltr;
            transition: all 0.3s ease;
        }

        body.night-mode {
            background: var(--dark-blue);
            color: var(--white);
        }

        body.night-mode .ayah-text {
            color: var(--white);
        }

        .controls-container {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .controls-container button {
            background: var(--primary-blue);
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 1.1em;
            padding: 8px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .controls-container button:hover {
            background: var(--secondary-blue);
            transform: scale(1.1);
        }

        .hamburger {
            position: fixed;
            top: 10px;
            left: 10px;
            width: 40px;
            height: 40px;
            background: var(--primary-blue);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: var(--white);
            margin: 2px 0;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -7px);
        }

        .hamburger:hover {
            background: var(--secondary-blue);
        }

        .nav-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: var(--primary-blue);
            padding: 60px 20px 20px;
            box-shadow: 2px 0 15px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: left 0.3s ease;
        }

        .nav-menu.active {
            left: 0;
        }

        select, #favoritesBtn {
            padding: 12px 40px 12px 20px;
            border: 2px solid var(--white);
            border-radius: 8px;
            font-size: 1.1em;
            background-color: var(--white);
            color: var(--primary-blue);
            cursor: pointer;
            width: 100%;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232A5C8A'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            transition: all 0.3s ease;
            margin: 15px 0;
        }

        body.night-mode select, body.night-mode #favoritesBtn {
            background-color: #2A3C4D;
            color: var(--white);
            border-color: var(--secondary-blue);
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2388BDEB'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
        }

        select:hover, #favoritesBtn:hover {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 5px rgba(136, 189, 235, 0.5);
        }

        #autoPlayBtn {
            padding: 12px;
            border: 2px solid var(--white);
            border-radius: 8px;
            background-color: var(--white);
            color: var(--primary-blue);
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            text-align: center;
            transition: all 0.3s ease;
            margin: 15px 0;
        }

        #autoPlayBtn.active {
            background-color: var(--secondary-blue);
            color: var(--white);
        }

        #autoPlayBtn:hover {
            background-color: var(--secondary-blue);
            color: var(--white);
        }

        #ayahContainer {
            max-width: 1200px;
            margin: 60px auto 20px;
            padding: 0 20px;
        }

        .ayah {
            margin: 25px 0;
            padding: 20px;
            border-bottom: 1px solid var(--primary-blue);
        }

        .ayah-text {
            font-size: 28px;
            color: var(--primary-blue);
            direction: rtl;
            text-align: right;
        }

        .translation {
            font-size: 18px;
            color: var(--text-dark);
            direction: ltr;
            text-align: left;
        }

        body.night-mode .translation {
            color: var(--secondary-blue);
        }

        .copy-btn, .play-btn, .share-btn, .favorite-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background-color: var(--primary-blue);
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .favorite-btn.active {
            background-color: var(--favorite-red);
        }

        .copy-btn:hover, .play-btn:hover, .share-btn:hover, .favorite-btn:hover {
            background-color: var(--secondary-blue);
            transform: scale(1.05);
        }

        .favorite-btn.active:hover {
            background-color: var(--favorite-red);
        }

        @media (max-width: 768px) {
            #ayahContainer {
                margin: 60px 15px 20px;
                padding: 0 15px;
            }

            .ayah-text {
                font-size: 24px;
            }

            .translation {
                font-size: 16px;
            }

            .nav-menu {
                width: 250px;
            }
        }
    </style>
</head>
<body>
    <button class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <div class="controls-container">
        <button id="modeToggle" title="Night Mode">
            <i class="fas fa-moon"></i>
        </button>
        <button id="translationToggle" title="Toggle Translation">
            <i class="fas fa-language"></i>
        </button>
        <button id="fontSizeToggle" title="Toggle Font Size">
            <i class="fas fa-text-height"></i>
        </button>
    </div>

    <nav class="nav-menu" id="navMenu">
        <select id="surahSelect"></select>
        <select id="ayahSelect"></select>
        <select id="reciterSelect"></select>
        <select id="translationSelect"></select>
        <button id="autoPlayBtn">Auto Play</button>
        <button id="favoritesBtn">Show Favorites</button>
    </nav>

    <main id="ayahContainer"></main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const surahSelect = document.getElementById('surahSelect');
            const ayahSelect = document.getElementById('ayahSelect');
            const reciterSelect = document.getElementById('reciterSelect');
            const translationSelect = document.getElementById('translationSelect');
            const ayahContainer = document.getElementById('ayahContainer');
            const hamburger = document.getElementById('hamburger');
            const navMenu = document.getElementById('navMenu');
            const autoPlayBtn = document.getElementById('autoPlayBtn');
            const favoritesBtn = document.getElementById('favoritesBtn');
            
            let currentAudio = null;
            let audioAyahs = [];
            let currentAyahIndex = -1;
            let fontSizeAyah = 28;
            let fontSizeTranslation = 18;
            let showTranslation = true;
            let fontSizeLarge = false;
            let isAutoPlaying = false;

            const reciters = [
                { name: "Mishary Rashid Alafasy", id: "ar.alafasy" },
                { name: "Saud Al-Shuraim", id: "ar.saoodshuraym" },
                {name:"Ahmed alajami",id:"ar.ahmedajamy"},
                { name: "Abdurrahmaan As-Sudais", id: "ar.abdurrahmaansudais" },
                { name: "Abdul Basit Abdul Samad", id: "ar.abdulbasitmurattal" },
                { name: "Abo baker alhatree", id: "ar.shaatree" }
            ];

            const translations = [
                {name:"تفسير الميسر" , id :"ar.muyassar"},
                { name: "English (Sahih International)", id: "en.sahih" },
                { name: "Kurdish", id: "ku.asan" },
                { name: "French", id: "fr.hamidullah" },
                { name: "Spanish", id: "es.cortes" },
                { name: "Swedish", id: "sv.bernstrom" },
                { name: "Germane", id: "de.aburida" },
                { name: "Turkish", id: "tr.ates" }
            ];

            const surahNames = [
                "Al-Fatiha", "Al-Baqarah", "Aal-E-Imran", "An-Nisa", "Al-Ma'idah", 
                "Al-An'am", "Al-A'raf", "Al-Anfal", "At-Tawbah", "Yunus", 
                "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", 
                "Al-Isra", "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya", "Al-Hajj", 
                "Al-Mu’minun", "An-Nur", "Al-Furqan", "Ash-Shu’ara", "An-Naml", 
                "Al-Qasas", "Al-Ankabut", "Ar-Rum", "Luqman", "As-Sajda", 
                "Al-Ahzab", "Saba", "Fatir", "Ya-Sin", "As-Saffat", "Sad", 
                "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura", "Az-Zukhruf", 
                "Ad-Dukhan", "Al-Jathiya", "Al-Ahqaf", "Muhammad", "Al-Fath", 
                "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur", "An-Najm", 
                "Al-Qamar", "Ar-Rahman", "Al-Waqi'a", "Al-Hadid", "Al-Mujadila", 
                "Al-Hashr", "Al-Mumtahina", "As-Saff", "Al-Jumu'a", "Al-Munafiqun", 
                "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", 
                "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn", "Al-Muzzammil", 
                "Al-Muddathir", "Al-Qiyama", "Al-Insan", "Al-Mursalat", "An-Naba", 
                "An-Nazi'at", "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", 
                "Al-Inshiqaq", "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghashiya", 
                "Al-Fajr", "Al-Balad", "Ash-Shams", "Al-Lail", "Ad-Duha", 
                "Ash-Sharh", "At-Tin", "Al-Alaq", "Al-Qadr", "Al-Bayyina", 
                "Az-Zalzala", "Al-Adiyat", "Al-Qari'a", "At-Takathur", "Al-Asr", 
                "Al-Humaza", "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", 
                "Al-Kafirun", "An-Nasr", "Al-Masad", "Al-Ikhlas", "Al-Falaq", 
                "An-Nas"
            ];

            // Initialization
            populateSelects();
            loadFullQuran();
            setupEventListeners();

            function populateSelects() {
                reciters.forEach(reciter => {
                    const option = new Option(reciter.name, reciter.id);
                    reciterSelect.add(option);
                });

                translations.forEach(translation => {
                    const option = new Option(translation.name, translation.id);
                    translationSelect.add(option);
                });

                surahNames.forEach((name, index) => {
                    const option = new Option(name, index + 1);
                    surahSelect.add(option);
                });
            }

            async function loadFullQuran() {
                try {
                    const quranResponse = await fetch('https://api.alquran.cloud/v1/quran/ar');
                    const quranData = await quranResponse.json();
                    const translationResponse = await fetch(`https://api.alquran.cloud/v1/quran/${translationSelect.value}`);
                    const translationData = await translationResponse.json();
                    
                    window.fullQuranData = quranData.data.surahs;
                    window.fullTranslationData = translationData.data.surahs;
                    
                    loadSurah();
                } catch (error) {
                    console.error('Error loading data:', error);
                    ayahContainer.innerHTML = '<p>Error loading Quran data. Please try again later.</p>';
                }
            }

            function setupEventListeners() {
                hamburger.addEventListener('click', () => {
                    hamburger.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });

                const modeToggle = document.getElementById('modeToggle');
                modeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('night-mode');
                    const icon = modeToggle.querySelector('i');
                    icon.classList.toggle('fa-moon');
                    icon.classList.toggle('fa-sun');
                });

                const translationToggle = document.getElementById('translationToggle');
                translationToggle.addEventListener('click', () => {
                    showTranslation = !showTranslation;
                    document.querySelectorAll('.translation').forEach(t => 
                        t.style.display = showTranslation ? 'block' : 'none'
                    );
                });

                const fontSizeToggle = document.getElementById('fontSizeToggle');
                fontSizeToggle.addEventListener('click', () => {
                    fontSizeLarge = !fontSizeLarge;
                    fontSizeAyah = fontSizeLarge ? 36 : 28;
                    fontSizeTranslation = fontSizeLarge ? 24 : 18;
                    document.querySelectorAll('.ayah-text').forEach(t => t.style.fontSize = `${fontSizeAyah}px`);
                    document.querySelectorAll('.translation').forEach(t => t.style.fontSize = `${fontSizeTranslation}px`);
                });

                autoPlayBtn.addEventListener('click', () => {
                    isAutoPlaying = !isAutoPlaying;
                    autoPlayBtn.classList.toggle('active');
                    autoPlayBtn.textContent = isAutoPlaying ? 'Stop Auto Play' : 'Auto Play';
                    if (isAutoPlaying && !currentAudio) {
                        playNextAyah(0);
                    }
                });

                favoritesBtn.addEventListener('click', showFavorites);

                surahSelect.addEventListener('change', loadSurah);
                reciterSelect.addEventListener('change', loadSurah);
                translationSelect.addEventListener('change', loadFullQuran);
                ayahSelect.addEventListener('change', scrollToAyah);
            }

            async function loadSurah() {
                const surahNumber = surahSelect.value;
                const reciter = reciterSelect.value;

                try {
                    const audioResponse = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/${reciter}`);
                    const audioData = await audioResponse.json();
                    audioAyahs = audioData.data.ayahs;
                    currentAyahIndex = -1;
                    
                    displayAyahs(
                        fullQuranData[surahNumber - 1].ayahs,
                        fullTranslationData[surahNumber - 1].ayahs,
                        audioAyahs
                    );
                    populateAyahSelect(fullQuranData[surahNumber - 1].ayahs.length);
                } catch (error) {
                    console.error('Error loading surah:', error);
                }
            }

            function populateAyahSelect(count) {
                ayahSelect.innerHTML = '';
                for(let i = 1; i <= count; i++) {
                    const option = new Option(`Verse ${i}`, i - 1);
                    ayahSelect.add(option);
                }
            }

            function displayAyahs(arabicAyahs, translationAyahs, audioAyahs) {
                const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                
                ayahContainer.innerHTML = arabicAyahs.map((ayah, index) => {
                    const isFavorite = favorites.some(fav => 
                        fav.surah === surahSelect.value && fav.ayah === index
                    );
                    return `
                        <div class="ayah" data-index="${index}" data-surah="${surahSelect.value}">
                            <div class="ayah-text" style="font-size: ${fontSizeAyah}px">
                                ${arabicAyahs[index].text} (${index + 1})
                            </div>
                            <div class="translation" style="font-size: ${fontSizeTranslation}px; display: ${showTranslation ? 'block' : 'none'}">
                                ${translationAyahs[index].text}
                            </div>
                            <button class="copy-btn">Copy</button>
                            <button class="play-btn" data-audio="${audioAyahs[index].audio}">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="share-btn" data-surah="${surahSelect.value}" data-ayah="${index}">
                                <i class="fas fa-share-alt"></i>
                            </button>
                            <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-surah="${surahSelect.value}" data-ayah="${index}">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    `;
                }).join('');

                // Copy button functionality
                document.querySelectorAll('.copy-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        navigator.clipboard.writeText(btn.parentElement.querySelector('.ayah-text').textContent);
                        btn.textContent = 'Copied!';
                        setTimeout(() => btn.textContent = 'Copy', 2000);
                    });
                });

                // Play button functionality
                document.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', () => toggleAudio(btn, btn.parentElement.dataset.index));
                });

                // Share button functionality
                document.querySelectorAll('.share-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const surah = btn.dataset.surah;
                        const ayah = btn.dataset.ayah;
                        const ayahText = btn.parentElement.querySelector('.ayah-text').textContent;
                        const translationText = btn.parentElement.querySelector('.translation').textContent;
                        const shareUrl = `${window.location.origin}?surah=${surah}&ayah=${ayah}`;
                        const shareData = {
                            title: `Quran - Surah ${surahNames[surah - 1]} Ayah ${parseInt(ayah) + 1}`,
                            text: `${ayahText}\n\nTranslation: ${translationText}`,
                            url: shareUrl
                        };

                        if (navigator.share) {
                            // Use Web Share API if available
                            navigator.share(shareData)
                                .then(() => console.log('Shared successfully'))
                                .catch(err => console.error('Error sharing:', err));
                        } else {
                            // Fallback: Copy URL to clipboard
                            navigator.clipboard.writeText(`${shareData.title}\n${shareData.text}\n${shareData.url}`);
                            btn.innerHTML = '<i class="fas fa-check"></i>';
                            setTimeout(() => btn.innerHTML = '<i class="fas fa-share-alt"></i>', 2000);
                            alert('Share details copied to clipboard!');
                        }
                    });
                });

                // Favorite button functionality
                document.querySelectorAll('.favorite-btn').forEach(btn => {
                    btn.addEventListener('click', () => toggleFavorite(btn));
                });
            }

            function toggleAudio(button, index) {
                const audioUrl = button.dataset.audio;
                
                if (currentAudio && !currentAudio.paused && currentAudio.src === audioUrl) {
                    currentAudio.pause();
                    button.innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    if (currentAudio) currentAudio.pause();
                    currentAudio = new Audio(audioUrl);
                    currentAudio.play();
                    button.innerHTML = '<i class="fas fa-pause"></i>';
                    currentAyahIndex = parseInt(index);
                    
                    document.querySelectorAll('.play-btn').forEach(b => {
                        if (b !== button) b.innerHTML = '<i class="fas fa-play"></i>';
                    });

                    const ayahElement = document.querySelector(`.ayah[data-index="${currentAyahIndex}"]`);
                    if (ayahElement) {
                        ayahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }

                    currentAudio.onended = () => {
                        button.innerHTML = '<i class="fas fa-play"></i>';
                        if (isAutoPlaying && currentAyahIndex < audioAyahs.length - 1) {
                            playNextAyah(currentAyahIndex + 1);
                        }
                    };
                }
            }

            function playNextAyah(index) {
                if (index >= audioAyahs.length) {
                    isAutoPlaying = false;
                    autoPlayBtn.classList.remove('active');
                    autoPlayBtn.textContent = 'Auto Play';
                    return;
                }

                const nextBtn = document.querySelector(`.ayah[data-index="${index}"] .play-btn`);
                if (nextBtn) {
                    toggleAudio(nextBtn, index);
                }
            }

            function scrollToAyah() {
                const ayahElement = document.querySelector(`.ayah[data-index="${ayahSelect.value}"]`);
                if (ayahElement) {
                    ayahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    const playBtn = ayahElement.querySelector('.play-btn');
                    toggleAudio(playBtn, ayahSelect.value);
                }
            }

            function toggleFavorite(button) {
                const surah = button.dataset.surah;
                const ayah = parseInt(button.dataset.ayah);
                let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

                const isFavorite = favorites.some(fav => fav.surah === surah && fav.ayah === ayah);
                if (isFavorite) {
                    favorites = favorites.filter(fav => !(fav.surah === surah && fav.ayah === ayah));
                    button.classList.remove('active');
                } else {
                    favorites.push({ surah, ayah, text: button.parentElement.querySelector('.ayah-text').textContent });
                    button.classList.add('active');
                }

                localStorage.setItem('favorites', JSON.stringify(favorites));
            }

            function showFavorites() {
                const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                if (favorites.length === 0) {
                    ayahContainer.innerHTML = '<p>No favorite ayahs saved yet.</p>';
                    return;
                }

                ayahContainer.innerHTML = favorites.map(fav => `
                    <div class="ayah" data-surah="${fav.surah}" data-index="${fav.ayah}">
                        <div class="ayah-text" style="font-size: ${fontSizeAyah}px">
                            ${fav.text}
                        </div>
                        <button class="play-btn" data-audio="${audioAyahs[fav.ayah]?.audio || ''}">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="favorite-btn active" data-surah="${fav.surah}" data-ayah="${fav.ayah}">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                `).join('');

                document.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', () => toggleAudio(btn, btn.parentElement.dataset.index));
                });

                document.querySelectorAll('.favorite-btn').forEach(btn => {
                    btn.addEventListener('click', () => toggleFavorite(btn));
                });
            }
        });
    </script>
</body>
</html>
